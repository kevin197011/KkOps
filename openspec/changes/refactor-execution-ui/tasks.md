# Tasks: 重构运维执行页面为快速执行操作台

## 1. 后端 API（如需要）

- [x] 1.1 创建 `POST /api/v1/executions/quick-execute` 端点（可选，也可复用现有 API）
  - [x] 1.1.1 支持临时执行（不创建任务）- 复用现有 API，通过 create + execute 实现
  - [x] 1.1.2 支持可选创建任务并执行 - 已实现
  - [x] 1.1.3 返回执行记录 ID - 已实现
- [x] 1.2 更新 `Task` Model（如需要 `is_temporary` 字段）- 暂不需要，复用现有模型

## 2. 前端组件重构

- [x] 2.1 创建 `ExecutionModeSelector` 组件
  - [x] 2.1.1 模板模式/自定义模式切换
  - [x] 2.1.2 模板选择下拉框
  - [x] 2.1.3 模板信息显示
- [x] 2.2 创建 `ScriptEditor` 组件
  - [x] 2.2.1 代码编辑器（支持语法高亮）- 使用 TextArea，使用 JetBrains Mono 字体
  - [x] 2.2.2 脚本类型选择（shell/python）
  - [x] 2.2.3 模板模式下只读显示
- [x] 2.3 创建 `HostSelector` 组件
  - [x] 2.3.1 项目/环境筛选器
  - [x] 2.3.2 主机搜索框
  - [x] 2.3.3 主机列表（复选框）
  - [x] 2.3.4 批量选择按钮（全选、按项目选、按环境选、清空）
  - [x] 2.3.5 已选主机计数
- [x] 2.4 创建 `ExecutionOptions` 组件
  - [x] 2.4.1 执行方式选择（同步/异步）
  - [x] 2.4.2 超时时间设置
  - [x] 2.4.3 是否保存为任务（复选框）
- [x] 2.5 重构 `ExecutionResults` 组件
  - [x] 2.5.1 执行状态展示
  - [x] 2.5.2 每个主机的执行状态卡片
  - [x] 2.5.3 内联日志查看器（可展开/折叠）
  - [x] 2.5.4 实时日志流式更新

## 3. 页面重构

- [x] 3.1 重构 `TaskManagementPage.tsx` 为 `ExecutionOperatorPage.tsx`
  - [x] 3.1.1 移除左侧工作流列表
  - [x] 3.1.2 改为单页表单布局
  - [x] 3.1.3 集成所有新组件
  - [x] 3.1.4 实现执行流程逻辑
  - [x] 3.1.5 实现保存为任务功能（可选）
- [x] 3.2 更新路由和导入
  - [x] 3.2.1 更新 `App.tsx` 中的路由
  - [x] 3.2.2 更新组件导入

## 4. API 集成

- [x] 4.1 更新 `execution.ts` API 客户端
  - [x] 4.1.1 添加 `quickExecute` 方法（如需要新端点）- 复用现有 API
  - [x] 4.1.2 或复用现有的 `create` + `execute` 方法 - 已实现
- [x] 4.2 更新组件中的 API 调用
  - [x] 4.2.1 模板列表获取
  - [x] 4.2.2 主机列表获取（支持筛选）
  - [x] 4.2.3 执行请求
  - [x] 4.2.4 执行状态轮询（异步执行）

## 5. WebSocket 集成

- [x] 5.1 集成执行日志 WebSocket
  - [x] 5.1.1 连接 WebSocket 端点
  - [x] 5.1.2 实时接收日志
  - [x] 5.1.3 更新到对应的主机日志显示区
  - [x] 5.1.4 处理连接断开和错误

## 6. UI/UX 优化

- [x] 6.1 响应式布局优化
  - [x] 6.1.1 移动端适配 - 使用 Ant Design 的响应式组件
  - [x] 6.1.2 平板适配 - 使用 Ant Design 的响应式组件
- [x] 6.2 交互优化
  - [x] 6.2.1 加载状态显示
  - [x] 6.2.2 错误提示优化
  - [x] 6.2.3 成功提示和结果展示
- [x] 6.3 表单验证
  - [x] 6.3.1 必填项验证
  - [x] 6.3.2 主机选择验证（至少选择一个）
  - [x] 6.3.3 脚本内容验证

## 7. 测试和验证

- [ ] 7.1 功能测试
  - [ ] 7.1.1 模板模式执行测试 - 需要手动测试
  - [ ] 7.1.2 自定义模式执行测试 - 需要手动测试
  - [ ] 7.1.3 主机选择测试（项目筛选、环境筛选、搜索）- 需要手动测试
  - [ ] 7.1.4 同步/异步执行测试 - 需要手动测试
  - [ ] 7.1.5 保存为任务测试 - 需要手动测试
- [ ] 7.2 集成测试
  - [ ] 7.2.1 WebSocket 日志流测试 - 需要手动测试
  - [ ] 7.2.2 执行状态更新测试 - 需要手动测试
  - [ ] 7.2.3 多主机执行测试 - 需要手动测试
- [ ] 7.3 UI 测试
  - [ ] 7.3.1 响应式布局测试 - 需要手动测试
  - [ ] 7.3.2 交互流程测试 - 需要手动测试
