# Tasks: 审计日志功能

## 1. 后端数据层

- [x] 1.1 创建 `audit_logs` 数据库迁移文件
- [x] 1.2 创建 `AuditLog` Model
- [x] 1.3 在 `database.go` 中添加 AutoMigrate

## 2. 后端服务层

- [x] 2.1 创建 `audit` Service
  - [x] 2.1.1 实现 `CreateLog` 方法
  - [x] 2.1.2 实现 `ListLogs` 方法（支持分页和筛选）
  - [x] 2.1.3 实现 `ExportLogs` 方法（CSV/JSON）
  - [x] 2.1.4 实现 `CleanupOldLogs` 方法（定期清理）
- [x] 2.2 实现敏感字段过滤工具函数

## 3. 后端中间件

- [x] 3.1 创建审计中间件 `audit.go`
  - [x] 3.1.1 解析请求信息（用户、IP、UserAgent）
  - [x] 3.1.2 根据路由配置决定是否记录
  - [x] 3.1.3 异步写入审计日志
- [x] 3.2 配置审计路由映射

## 4. 后端 API 层

- [x] 4.1 创建 `audit` Handler
  - [x] 4.1.1 实现 `ListAuditLogs` 接口
  - [x] 4.1.2 实现 `ExportAuditLogs` 接口
- [x] 4.2 在 `main.go` 中注册路由
- [x] 4.3 应用审计中间件到需要审计的路由

## 5. 前端 API 层

- [x] 5.1 创建 `audit.ts` API 客户端
  - [x] 5.1.1 定义 `AuditLog` 接口
  - [x] 5.1.2 实现 `list` 方法
  - [x] 5.1.3 实现 `export` 方法

## 6. 前端页面

- [x] 6.1 创建 `AuditLogList.tsx` 页面
  - [x] 6.1.1 实现审计日志表格
  - [x] 6.1.2 实现筛选表单（用户、模块、操作、时间范围）
  - [x] 6.1.3 实现关键词搜索
  - [x] 6.1.4 实现分页
  - [x] 6.1.5 实现详情查看弹窗
  - [x] 6.1.6 实现导出功能
- [x] 6.2 在 `MainLayout.tsx` 添加菜单项
- [x] 6.3 在 `App.tsx` 添加路由

## 7. 配置和文档

- [x] 7.1 审计配置已内置到中间件（默认启用）
- [x] 7.2 敏感字段过滤已内置

## 8. 验证

- [x] 8.1 验证登录/登出审计记录
- [x] 8.2 验证用户管理操作审计记录
- [x] 8.3 验证资产管理操作审计记录
- [x] 8.4 验证任务执行审计记录
- [x] 8.5 验证审计日志查询和筛选
- [x] 8.6 验证审计日志导出功能
